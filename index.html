<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>MIMO Companion</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0; padding: 0; background-color: #050505; color: #ffffff;
            font-family: 'JetBrains Mono', monospace; overflow: hidden;
            touch-action: none; height: 100dvh;
        }
        .scanline {
            width: 100%; height: 2px; background: rgba(34, 211, 238, 0.05);
            position: absolute; top: 0; left: 0; pointer-events: none;
            z-index: 5; animation: scan 6s linear infinite;
        }
        @keyframes scan { 0% { transform: translateY(0); } 100% { transform: translateY(100vh); } }
        .power-pulse { animation: pulse-cyan 2.5s infinite ease-in-out; }
        @keyframes pulse-cyan { 0%, 100% { opacity: 0.4; transform: scaleX(0.95); } 50% { opacity: 0.8; transform: scaleX(1); } }
        .speaking-glow { animation: glow-pulse 0.5s infinite alternate; }
        @keyframes glow-pulse { from { filter: drop-shadow(0 0 5px rgba(34, 211, 238, 0.5)); } to { filter: drop-shadow(0 0 20px rgba(34, 211, 238, 1)); } }
        .float-anim { animation: float 3s infinite ease-in-out; }
        @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-10px); } }
        .rubiks-spin { animation: spin-cube 2.5s infinite linear; }
        @keyframes spin-cube { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const apiKey = ""; 

        const Icons = {
            Settings: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2l-.2.1a2 2 0 0 1-2.81.35l-.17-.1a2 2 0 0 0-2.82.73l-.22.38a2 2 0 0 0 .73 2.82l.14.1a2 2 0 0 1 .35 2.82l-.1.14a2 2 0 0 0 .73 2.82l.38.22a2 2 0 0 0 2.82-.73l.1-.14a2 2 0 0 1 2.82-.35l.14.1a2 2 0 0 0 2.82-.73l.22-.38a2 2 0 0 0-.73-2.82l-.14-.1a2 2 0 0 1-.35-2.82l.1-.14a2 2 0 0 0-.73-2.82l-.38-.22a2 2 0 0 0-2.82.73l-.1.14a2 2 0 0 1-2.82.35l-.14-.1a2 2 0 0 0-2.82.73l-.22.38a2 2 0 0 0 .73 2.82l.14.1a2 2 0 0 1 .35 2.82l-.1.14a2 2 0 0 0 .73 2.82l.38.22a2 2 0 0 0 2.82-.73l.1-.14a2 2 0 0 1 2.82-.35l.14.1a2 2 0 0 0 2.82-.73l.22-.38a2 2 0 0 0-.73-2.82l-.14-.1a2 2 0 0 1-.35-2.82l.1-.14a2 2 0 0 0-.73-2.82z"/><circle cx="12" cy="12" r="3"/></svg>,
            Rotate: () => <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" className="text-cyan-500 animate-[spin_4s_linear_infinite]"><path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/></svg>,
            Zap: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-cyan-400"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
            Mic: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="22"/></svg>,
            MicOff: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="opacity-40"><line x1="1" y1="1" x2="23" y2="23"/><path d="M9 9v3a3 3 0 0 0 5.12 2.12M15 9.34V5a3 3 0 0 0-5.94-.6"/><path d="M17 16.95A7 7 0 0 1 5 12v-2m14 0v2a7 7 0 0 1-.11 1.23"/><line x1="12" y1="19" x2="12" y2="22"/></svg>,
            Cube: () => <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-cyan-400"><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M3 9h18M3 15h18M9 3v18M15 3v18"/></svg>,
            Lunch: () => <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-cyan-400"><path d="M3 11c0-1.7 1.3-3 3-3h12c1.7 0 3 1.3 3 3v2H3v-2z"/><path d="M3 18c0 1.7 1.3 3 3 3h12c1.7 0 3-1.3 3-3v-2H3v2z"/><path d="M3 14h18v1H3z"/></svg>
        };

        const App = () => {
            const [isLandscape, setIsLandscape] = useState(false);
            const [isAsleep, setIsAsleep] = useState(true);
            const [mood, setMood] = useState('neutral');
            const [idleAction, setIdleAction] = useState(null); 
            const [eyePos, setEyePos] = useState({ x: 0, y: 0 });
            const [isBlinking, setIsBlinking] = useState(false);
            const [showSettings, setShowSettings] = useState(false);
            const [isListening, setIsListening] = useState(false);
            const [isWakewordActive, setIsWakewordActive] = useState(false);
            const [isSpeaking, setIsSpeaking] = useState(false);
            const [localKey, setLocalKey] = useState(localStorage.getItem('mimo_key') || "");

            const recognitionRef = useRef(null);
            const idleTimerRef = useRef(null);

            useEffect(() => {
                const checkOrientation = () => setIsLandscape(window.innerWidth > window.innerHeight);
                window.addEventListener('resize', checkOrientation);
                checkOrientation();
                return () => window.removeEventListener('resize', checkOrientation);
            }, []);

            const resetIdleTimer = () => {
                if (idleTimerRef.current) clearTimeout(idleTimerRef.current);
                if (idleAction) setIdleAction(null);
                
                idleTimerRef.current = setTimeout(() => {
                    if (!isAsleep && !isSpeaking && !isListening) {
                        const rand = Math.random();
                        if (rand < 0.33) {
                            setIsAsleep(true);
                            stopRecognition();
                        } else if (rand < 0.66) {
                            setIdleAction('eating');
                        } else {
                            setIdleAction('cube');
                        }
                    }
                }, 45000); 
            };

            useEffect(() => {
                resetIdleTimer();
                return () => clearTimeout(idleTimerRef.current);
            }, [isAsleep, isSpeaking, isListening]);

            const startRecognition = () => {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                if (!SpeechRecognition) return;
                recognitionRef.current = new SpeechRecognition();
                recognitionRef.current.continuous = true;
                recognitionRef.current.interimResults = true;
                recognitionRef.current.lang = 'en-US';
                recognitionRef.current.onstart = () => setIsWakewordActive(true);
                recognitionRef.current.onend = () => { if (!isAsleep && isWakewordActive) try { recognitionRef.current.start(); } catch(e) {} };
                recognitionRef.current.onresult = (event) => {
                    const transcript = Array.from(event.results).map(result => result[0].transcript).join('').toLowerCase();
                    
                    // Phonetic Triggers for "Mimo": 
                    // - My mo / Mymo (Long I)
                    // - Me mo / Memo (Short E)
                    // - Plus Nemo and variations
                    const triggers = [
                        "mimo", "memo", "me mo", "mymo", "my mo", "meemo", "me mo",
                        "nemo", "nimo", "ne mo", "ni mo", "amino", "hey me",
                        "hey memo", "hey mymo", "hey mimo", "hi memo", "hi mymo", "hi mimo"
                    ];

                    if (triggers.some(t => transcript.includes(t))) {
                        if (!isListening && !isSpeaking) handleWakewordDetected();
                    }
                };
                try { recognitionRef.current.start(); } catch(e) {}
            };

            const stopRecognition = () => { setIsWakewordActive(false); if (recognitionRef.current) recognitionRef.current.stop(); };

            const handleWakewordDetected = () => {
                resetIdleTimer();
                setIsListening(true);
                if (recognitionRef.current) recognitionRef.current.stop();
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                const cmdRec = new SpeechRecognition();
                cmdRec.onresult = (e) => handleConversation(e.results[0][0].transcript);
                cmdRec.onend = () => { setIsListening(false); if (isWakewordActive && !isAsleep) startRecognition(); };
                cmdRec.start();
            };

            const speak = async (text) => {
                try {
                    setIsSpeaking(true);
                    const result = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${localKey || apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: `Say briefly: ${text}` }] }],
                            generationConfig: { responseModalities: ["AUDIO"], speechConfig: { voiceConfig: { prebuiltVoiceConfig: { voiceName: "Kore" } } } }
                        })
                    }).then(r => r.json());
                    
                    const audioData = result.candidates[0].content.parts[0].inlineData;
                    const audioBuffer = pcmToWav(new Int16Array(Uint8Array.from(atob(audioData.data), c => c.charCodeAt(0)).buffer), 24000);
                    const audio = new Audio(URL.createObjectURL(new Blob([audioBuffer], { type: 'audio/wav' })));
                    audio.onended = () => { setIsSpeaking(false); setMood('neutral'); resetIdleTimer(); };
                    audio.play();
                } catch (e) { setIsSpeaking(false); }
            };

            const handleConversation = async (query) => {
                resetIdleTimer();
                try {
                    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${localKey || apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: query }] }],
                            systemInstruction: { parts: [{ text: "You are MIMO. Professional robot. Friendly. Brief." }] }
                        })
                    }).then(r => r.json());
                    const text = res.candidates?.[0]?.content?.parts?.[0]?.text;
                    if (text) { setMood('happy'); await speak(text); }
                } catch (e) {}
            };

            const pcmToWav = (pcm, rate) => {
                const buf = new ArrayBuffer(44 + pcm.length * 2);
                const view = new DataView(buf);
                const s = (o, str) => { for (let i = 0; i < str.length; i++) view.setUint8(o + i, str.charCodeAt(i)); };
                s(0, 'RIFF'); view.setUint32(4, 32 + pcm.length * 2, true); s(8, 'WAVE'); s(12, 'fmt ');
                view.setUint32(16, 16, true); view.setUint16(20, 1, true); view.setUint16(22, 1, true);
                view.setUint32(24, rate, true); view.setUint32(28, rate * 2, true);
                view.setUint16(32, 2, true); view.setUint16(34, 16, true); s(36, 'data');
                view.setUint32(40, pcm.length * 2, true);
                for (let i = 0, o = 44; i < pcm.length; i++, o += 2) view.setInt16(o, pcm[i], true);
                return buf;
            };

            if (!isLandscape) {
                return (
                    <div className="flex flex-col items-center justify-center min-h-[100dvh] bg-[#050505] p-6 text-center">
                        <Icons.Rotate /><h1 className="text-2xl font-bold tracking-[0.2em] uppercase mt-12 mb-4 text-zinc-200">Initialize MIMO</h1>
                        <p className="text-zinc-600 max-w-xs text-xs tracking-widest leading-relaxed">Rotate device for link.</p>
                    </div>
                );
            }

            return (
                <div className="relative w-full h-[100dvh] bg-black overflow-hidden flex items-center justify-center" onClick={() => { if(isAsleep) setIsAsleep(false); resetIdleTimer(); }}>
                    <div className="scanline" />
                    <button onClick={(e) => { e.stopPropagation(); setShowSettings(true); }} className="absolute top-6 right-6 p-2 text-zinc-700 z-50"><Icons.Settings /></button>

                    <div className="absolute top-8 left-8 flex flex-col gap-1 z-10">
                        <div className="text-[10px] text-cyan-500 font-bold tracking-[0.3em] uppercase">MIMO-OS_v3.8</div>
                        <div className="text-[8px] text-zinc-600 font-mono tracking-tighter uppercase flex items-center gap-2">
                            <div className={`w-1.5 h-1.5 rounded-full ${isAsleep ? 'bg-zinc-900' : 'bg-cyan-500 animate-pulse'}`} />
                            {isAsleep ? 'Standby' : idleAction ? `Task: ${idleAction}` : 'Neural Link Active'}
                        </div>
                    </div>

                    {!isAsleep && (
                        <button 
                            onClick={(e) => { e.stopPropagation(); isWakewordActive ? stopRecognition() : startRecognition(); }}
                            className={`absolute bottom-8 left-8 p-4 rounded-full z-50 transition-all ${isWakewordActive ? 'bg-cyan-500 text-black shadow-[0_0_20px_rgba(6,182,212,0.5)]' : 'bg-zinc-900 text-zinc-500'}`}
                        >
                            {isWakewordActive ? <Icons.Mic /> : <Icons.MicOff />}
                        </button>
                    )}

                    <div className="relative flex items-center justify-center" style={{ transform: `translate(${eyePos.x}px, ${eyePos.y}px)` }}>
                        {idleAction && (
                            <div className="absolute inset-0 w-[150%] -left-[25%] flex justify-between items-center pointer-events-none z-20 transition-opacity duration-500 opacity-100 px-4">
                                <div className="w-14 h-24 bg-zinc-900/80 rounded-full border border-zinc-800 float-anim flex items-center justify-center shadow-2xl">
                                    {idleAction === 'eating' && <Icons.Lunch />}
                                </div>
                                <div className="w-14 h-24 bg-zinc-900/80 rounded-full border border-zinc-800 float-anim flex items-center justify-center shadow-2xl" style={{ animationDelay: '0.6s' }}>
                                    {idleAction === 'cube' && <div className="rubiks-spin"><Icons.Cube /></div>}
                                </div>
                            </div>
                        )}

                        <div className={`flex gap-24 md:gap-48 items-center justify-center transition-all duration-1000 ${isAsleep ? 'opacity-40 scale-90' : 'opacity-100 scale-100'}`}>
                            <Eye isBlinking={isBlinking} mood={mood} isAsleep={isAsleep} isSpeaking={isSpeaking} />
                            <Eye isBlinking={isBlinking} mood={mood} isAsleep={isAsleep} isSpeaking={isSpeaking} />
                        </div>
                    </div>

                    <div className="absolute top-12 left-1/2 -translate-x-1/2 flex flex-col items-center">
                        {isAsleep ? (
                            <div className="px-6 py-1 border border-cyan-500/10 bg-cyan-500/5 rounded-full text-[8px] text-cyan-800 uppercase tracking-[0.4em] power-pulse">Tap to Wake</div>
                        ) : (
                            <div className="px-6 py-1 border border-zinc-900 bg-zinc-900/10 rounded-full text-[8px] text-zinc-700 uppercase tracking-[0.4em]">
                                {idleAction ? "System Idle" : "Say 'Hey Mimo'"}
                            </div>
                        )}
                    </div>

                    {showSettings && (
                        <div className="absolute inset-0 bg-black/95 backdrop-blur-xl z-[100] flex items-center justify-center p-6">
                            <div className="w-full max-w-sm border border-zinc-800 bg-zinc-950 p-8 rounded-3xl">
                                <h2 className="text-sm font-bold tracking-widest text-cyan-500 uppercase mb-6 text-center">Neural Config</h2>
                                <input type="password" value={localKey} onChange={(e) => { setLocalKey(e.target.value); localStorage.setItem('mimo_key', e.target.value); }} placeholder="Gemini API Key..." className="w-full bg-zinc-900 border border-zinc-800 rounded-xl px-4 py-3 text-xs text-white outline-none mb-4 focus:border-cyan-500" />
                                <button onClick={() => setShowSettings(false)} className="w-full bg-cyan-600 text-white py-4 rounded-xl text-[10px] font-bold uppercase tracking-widest">Save & Close</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const Eye = ({ isBlinking, mood, isAsleep, isSpeaking }) => (
            <div className={`w-40 h-40 md:w-56 md:h-56 bg-zinc-900/30 rounded-[40px] md:rounded-[50px] p-8 flex items-center justify-center border border-zinc-800/30 transition-all duration-[120ms] ${isSpeaking ? 'speaking-glow' : ''} ${isBlinking ? 'scale-y-0 opacity-0' : 'scale-y-100'}`}>
                <div className="w-full h-full flex items-center justify-center">
                    {isAsleep ? <div className="w-full h-2 bg-cyan-600/50 rounded-full shadow-[0_0_15px_rgba(6,182,212,0.3)] power-pulse" /> : 
                     mood === 'happy' ? <svg viewBox="0 0 100 100" className="w-full h-full fill-cyan-400 drop-shadow-[0_0_15px_rgba(34,211,238,0.8)]"><path d="M10,65 C20,30 80,30 90,65 L90,80 C80,45 20,45 10,80 Z" /></svg> : 
                     <div className={`w-full h-full bg-cyan-400 rounded-[20px] md:rounded-[28px] shadow-[0_0_25px_rgba(6,182,212,0.5)] ${isSpeaking ? 'animate-pulse' : ''}`} />}
                </div>
            </div>
        );

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

